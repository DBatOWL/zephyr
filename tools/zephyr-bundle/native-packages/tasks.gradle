dependencies {

    //todo: uncomment when Github/S3 permits HEAD
    //    executable 'dgiagio:warp:0.3.0:linux-x64'

    implementation 'org.slf4j:slf4j-api'
    testImplementation project(':kernel-tests:kernel-test-common')
}


configurations {
    executable {
        extendsFrom api
        canBeResolved = true
    }
}

repositories {
    ivy {
        url 'https://github.com/'
        patternLayout {
            artifact 'dgiagio/[module]/releases/download/v[revision]/[classifier].warp-packer'
        }
        metadataSources {
            artifact()
        }
    }
}

jar {
    from("$buildDir/$binPath/warp"){
        into "$binPath"
    }
    from("$buildDir/$binPath/wine.zip"){
        into "$binPath"
    }


    from("$buildDir/$binPath/rcedit.exe"){
        into "$binPath"
    }
}

task downloadWarp(type: Download) {
    src warpDownloadURL
    dest "${buildDir}/$binPath/warp"
    overwrite false
    onlyIfModified true
    useETag true
}

task downloadWine(type: Download) {
    src wineDownloadURL
    dest "${buildDir}/$binPath/wine.zip"
    overwrite false
    onlyIfModified true
    useETag true
}

task downloadRcEdit(type: Download) {
    src rcEditDownloadURL
    dest "${buildDir}/$binPath/rcedit.exe"
    overwrite false
    onlyIfModified true
    useETag true
}

task unpackDependencies(type: Copy) {
    dependsOn configurations.executable
    from configurations.executable
    into "${project.buildDir}"
}

assemble.dependsOn(
        "downloadWarp",
        "downloadWine",
        "downloadRcEdit"
)
assemble.dependsOn unpackDependencies
